name: Deploy Stage Android CI

on:
  push:
    # tags:
    # eg: android_183
    # - 'android_[0-9]+'

jobs:
  android:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2
    - name: extract keystore
      env: 
        KEYSTORE: ${{ secrets.KEYSTORE }}
      run: echo $KEYSTORE | base64 --decode > ./app/keystore.jks
    - name: extract keystore properties
      env:
        KEYSTORE_PROPERTIES: ${{ secrets.KEYSTORE_PROPERTIES }}
      uses: DamianReeves/write-file-action
      with:
        path: ./app/keystore.properties
        contents: |
          echo $KEYSTORE_PROPERTIES
    - name: run fastlane
      uses: maierj/fastlane-action@v1.4.0
      with:
        lane: 'stage'
        subdirectory: 'app'
        options: '{"auto_increment": false}'